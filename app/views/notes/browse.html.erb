<script type="text/javascript">
    // TODO:
    // window.addEventListener('beforeunload', exitWarning);

    function itemActivated(id) {
	$('#viewer').load('/notes/'+id, renderNote);
    }

    function itemCreated() {
	$('#viewer').load('/notes/new', function(resp, status) {
	    if (status == 'error')
		return $('#viewer').html(resp);
	    itemEdited();
	});
    }

    function itemEdited() {
	var scope = $('#viewer');
	scope.find('.note:visible').hide();
	scope.find('.note-editor:not(:visible)').show();
	scope.find('.note-editor:visible form '+
		   'textarea[name=note\\[body\\]]').focus();
    }

    function itemInspected() {
	$('#viewer .note-editor form').each(function() {
	    var form = $(this);
	    $.ajax({
		url: '/notes/preview',
		method: 'post',
		data: form.serialize(),
		success: function(resp) {
		    var modal = $('<div tabindex="-1"/>').addClass('modal');
		    modal.append(
			$('<div/>').addClass('modal-dialog modal-lg').append(
			    $('<div/>').addClass('modal-content').append(
				$('<div/>').addClass('modal-body').html(resp)
			    )
			)
		    );
		    modal.css({width: '1000px', 'margin-left': '-500px'}).modal();
		    renderNote();
		}
	    });
	});
    }

    function itemSaved() {
	$('#viewer .note-editor form:visible').each(function() {
	    var form = $(this);
	    var container = form.parents('.note-editor');
	    var parent = container.parent();
	    submitNote(form, function(response) {
		browserActivate(response.id);
		refreshFilter();
	    });
	});
    }
</script>
